{"version":3,"sources":["../../../../../src/infrastructure/customer/repository/sequelize/customer.repository.spec.ts"],"sourcesContent":["import { Sequelize } from \"sequelize-typescript\";\nimport CustomerModel from \"./customer.model\";\nimport CustomerRepository from \"./customer.repository\";\nimport Customer from \"../../../../domain/customer/entity/customer\";\nimport Address from \"../../../../domain/customer/value-object/address\";\n\ndescribe(\"Customer Repository Test\", () => {\n\n    let sequelize: Sequelize; \n\n    beforeEach(async() => {\n        sequelize = new Sequelize({\n            dialect: 'sqlite', \n            storage: ':memory:', \n            logging: false, \n            sync: { force: true }, \n        });\n\n        sequelize.addModels([CustomerModel]); \n        await sequelize.sync();\n    }); \n\n    afterEach(async() => {\n        await sequelize.close();\n    }); \n\n    it(\"should create a customer\", async () => {\n        const customerRepository = new CustomerRepository();\n        const customer = new Customer(\"123\", \"Customer 1\");\n        const address = new Address(\"Street 1\", 9781, \"Zipcode1\", \"City 1\");\n        customer.address = address;\n      \n        await customerRepository.create(customer);\n          \n        const customerModel = await CustomerModel.findOne({ where: { id: \"123\" } });\n\n        expect(customerModel.toJSON()).toStrictEqual({\n          id: \"123\",\n          name: customer.name,\n          active: customer.isActive(),\n          rewardPoints: customer.rewardPoints,\n          street: address.street,\n          number: address.number,\n          zipcode: address.zip,\n          city: address.city,\n        });\n      });\n\n    it(\"should update a customer\", async() => {\n\n        const customerRepository = new CustomerRepository(); \n        const customer = new Customer(\"123\", \"Customer 001\"); \n        const address = new Address(\"Street of river\", 101, \"04195-120\", \"S達o Paulo\"); \n        customer.address = address;\n        await customerRepository.create(customer); \n\n        customer.changeName(\"Customer 002\"); \n        await customerRepository.update(customer); \n\n        const customerModel = await CustomerModel.findOne({ where: { id: \"123\" }}); \n\n        expect(customerModel.toJSON()).toStrictEqual({\n            id: \"123\", \n            name: customer.name, \n            active: customer.isActive(), \n            rewardPoints: customer.rewardPoints, \n            street: address.street, \n            number: address.number, \n            zipcode: address.zip, \n            city: address.city\n        }); \n\n    });\n    \n    it(\"should find a customer\", async() => {\n        const customerRepository = new CustomerRepository(); \n        const customer = new Customer(\"123\", \"Customer 001\"); \n        const address = new Address(\"Street 01\", 111, \"04280-000\", \"S達o Paulo\"); \n        customer.address = address; \n        await customerRepository.create(customer);\n        \n        const foundCustomer = await customerRepository.find(\"123\"); \n\n        expect(customer).toStrictEqual(foundCustomer); \n    }); \n\n    it(\"should find all customers\", async() => {\n\n        const customerRepository = new CustomerRepository();\n        const customer1 = new Customer(\"123\", \"Customer 001\"); \n        const address1 = new Address(\"Street 01\", 1001, \"04195-120\", \"S達o Paulo\"); \n        customer1.address = address1; \n        customer1.addRewardPoints(10); \n        customer1.activate();\n\n        const customer2 = new Customer(\"456\", \"Customer 02\"); \n        const address2 = new Address(\"Street 02\", 1002, \"02990-000\", \"S達o Paulo\"); \n        customer2.address = address2; \n        customer2.addRewardPoints(20); \n\n        await customerRepository.create(customer1); \n        await customerRepository.create(customer2); \n\n        const customers = await customerRepository.findAll();\n\n        expect(customers).toHaveLength(2); \n        expect(customers).toContainEqual(customer1); \n        expect(customers).toContainEqual(customer2); \n\n    }); \n\n\n\n\n}); "],"names":["Sequelize","CustomerModel","CustomerRepository","Customer","Address","describe","sequelize","beforeEach","dialect","storage","logging","sync","force","addModels","afterEach","close","it","customerRepository","customer","address","customerModel","create","findOne","where","id","expect","toJSON","toStrictEqual","name","active","isActive","rewardPoints","street","number","zipcode","zip","city","changeName","update","foundCustomer","find","customer1","address1","customer2","address2","customers","addRewardPoints","activate","findAll","toHaveLength","toContainEqual"],"mappings":"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"}