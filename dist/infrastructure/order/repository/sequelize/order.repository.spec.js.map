{"version":3,"sources":["../../../../../src/infrastructure/order/repository/sequelize/order.repository.spec.ts"],"sourcesContent":["import { Sequelize } from \"sequelize-typescript\";\nimport CustomerModel from \"../../../customer/repository/sequelize/customer.model\";\nimport CustomerRepository from \"../../../customer/repository/sequelize/customer.repository\";\nimport Customer from \"../../../../domain/customer/entity/customer\";\nimport Address from \"../../../../domain/customer/value-object/address\";\nimport OrderModel from \"./order.model\";\nimport OrderItemModel from \"./order-item\";\nimport ProductModel from \"../../../product/repository/sequelize/product.model\";\nimport ProductRepository from \"../../../product/repository/sequelize/product.repository\";\nimport Product from \"../../../../domain/product/entity/product\";\nimport OrderItem from \"../../../../domain/checkout/entity/order_item\";\nimport Order from \"../../../../domain/checkout/entity/order\";\nimport OrderRepository from \"./order.repository\";\n\ndescribe(\"Order Repository Test\", () => {\n\n    let sequelize: Sequelize; \n\n    beforeEach(async() => {\n        sequelize = new Sequelize({\n            dialect: 'sqlite', \n            storage: ':memory:', \n            logging: false, \n            sync: { force: true }, \n        });\n\n        sequelize.addModels([\n            CustomerModel, \n            OrderModel, \n            OrderItemModel, \n            ProductModel\n        ]); \n\n        await sequelize.sync();\n    }); \n\n    afterEach(async() => {\n        await sequelize.close();\n    }); \n\n    it(\"should create a order\", async () => {\n\n        const customerRepository = new CustomerRepository();\n        const customer = new Customer(\"123\", \"Customer 1\");\n        const address = new Address(\"Street 1\", 9781, \"Zipcode1\", \"City 1\");\n        customer.changeAddress(address);\n        await customerRepository.create(customer);\n\n        const productRepository = new ProductRepository();\n        const product = new Product(\"123\", \"Product 1\", 10.00);\n        await productRepository.create(product);    \n\n        const orderItem = new OrderItem(\n            \"1\", \n            product.name,             \n            product.price, \n            product.id,             \n            2\n        );\n\n        const order = new Order(\"123\", \"123\", [orderItem]);\n        const orderRepository = new OrderRepository();\n        await orderRepository.create(order);\n\n        const orderModel = await OrderModel.findOne({\n            where: { id: order.id }, \n            include: [\"items\"]\n        });\n\n        expect(orderModel.toJSON()).toStrictEqual({\n            id: \"123\", \n            customer_id: \"123\", \n            total: 20.00,\n            items: [\n                {\n                    id: orderItem.id, \n                    name: orderItem.name, \n                    price: orderItem.price, \n                    quantity: orderItem.quantity, \n                    order_id: \"123\", \n                    product_id: \"123\"\n                }\n            ]\n        });\n    }); \n\n\n\n\n}); "],"names":["Sequelize","CustomerModel","CustomerRepository","Customer","Address","OrderModel","OrderItemModel","ProductModel","ProductRepository","Product","OrderItem","Order","OrderRepository","describe","sequelize","beforeEach","dialect","storage","logging","sync","force","addModels","afterEach","close","it","customerRepository","customer","address","productRepository","product","orderItem","order","orderRepository","orderModel","changeAddress","create","name","price","id","findOne","where","include","expect","toJSON","toStrictEqual","customer_id","total","items","quantity","order_id","product_id"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,SAAS,QAAQ,uBAAuB;AACjD,OAAOC,mBAAmB,wDAAwD;AAClF,OAAOC,wBAAwB,6DAA6D;AAC5F,OAAOC,cAAc,8CAA8C;AACnE,OAAOC,aAAa,mDAAmD;AACvE,OAAOC,gBAAgB,gBAAgB;AACvC,OAAOC,oBAAoB,eAAe;AAC1C,OAAOC,kBAAkB,sDAAsD;AAC/E,OAAOC,uBAAuB,2DAA2D;AACzF,OAAOC,aAAa,4CAA4C;AAChE,OAAOC,eAAe,gDAAgD;AACtE,OAAOC,WAAW,2CAA2C;AAC7D,OAAOC,qBAAqB,qBAAqB;AAEjDC,SAAS,yBAAyB;IAE9B,IAAIC;IAEJC,WAAW;;;;;wBACPD,YAAY,IAAId,UAAU;4BACtBgB,SAAS;4BACTC,SAAS;4BACTC,SAAS;4BACTC,MAAM;gCAAEC,OAAO;4BAAK;wBACxB;wBAEAN,UAAUO,SAAS;4BACfpB;4BACAI;4BACAC;4BACAC;;wBAGJ;;4BAAMO,UAAUK,IAAI;;;wBAApB;;;;;;QACJ;;IAEAG,UAAU;;;;;wBACN;;4BAAMR,UAAUS,KAAK;;;wBAArB;;;;;;QACJ;;IAEAC,GAAG,yBAAyB;;gBAElBC,oBACAC,UACAC,SAIAC,mBACAC,SAGAC,WAQAC,OACAC,iBAGAC;;;;wBAtBAR,qBAAqB,IAAIvB;wBACzBwB,WAAW,IAAIvB,SAAS,OAAO;wBAC/BwB,UAAU,IAAIvB,QAAQ,YAAY,MAAM,YAAY;wBAC1DsB,SAASQ,aAAa,CAACP;wBACvB;;4BAAMF,mBAAmBU,MAAM,CAACT;;;wBAAhC;wBAEME,oBAAoB,IAAIpB;wBACxBqB,UAAU,IAAIpB,QAAQ,OAAO,aAAa;wBAChD;;4BAAMmB,kBAAkBO,MAAM,CAACN;;;wBAA/B;wBAEMC,YAAY,IAAIpB,UAClB,KACAmB,QAAQO,IAAI,EACZP,QAAQQ,KAAK,EACbR,QAAQS,EAAE,EACV;wBAGEP,QAAQ,IAAIpB,MAAM,OAAO;4BAAQmB;;wBACjCE,kBAAkB,IAAIpB;wBAC5B;;4BAAMoB,gBAAgBG,MAAM,CAACJ;;;wBAA7B;wBAEmB;;4BAAM1B,WAAWkC,OAAO,CAAC;gCACxCC,OAAO;oCAAEF,IAAIP,MAAMO,EAAE;gCAAC;gCACtBG,OAAO;oCAAG;;4BACd;;;wBAHMR,aAAa;wBAKnBS,OAAOT,WAAWU,MAAM,IAAIC,aAAa,CAAC;4BACtCN,IAAI;4BACJO,aAAa;4BACbC,OAAO;4BACPC,KAAK;gCACD;oCACIT,IAAIR,UAAUQ,EAAE;oCAChBF,MAAMN,UAAUM,IAAI;oCACpBC,OAAOP,UAAUO,KAAK;oCACtBW,UAAUlB,UAAUkB,QAAQ;oCAC5BC,UAAU;oCACVC,YAAY;gCAChB;;wBAER;;;;;;QACJ;;AAKJ"}