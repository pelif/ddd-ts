{"version":3,"sources":["../../../../../src/infrastructure/customer/repository/sequelize/customer.repository.ts"],"sourcesContent":["import Customer from \"../../../../domain/customer/entity/customer\";\nimport Address from \"../../../../domain/customer/value-object/address\";\nimport CustomerRepositoryInterface from \"../../../../domain/customer/repository/customer-repository.interface\";\nimport CustomerModel from \"./customer.model\";\n\nexport default class CustomerRepository implements CustomerRepositoryInterface {\n\n  async create(customer: Customer): Promise<void> {\n    await CustomerModel.create({\n      id: customer.id,\n      name: customer.name,\n      street: customer.address.street,\n      number: customer.address.number,\n      zipcode: customer.address.zip,\n      city: customer.address.city,\n      active: customer.isActive(),\n      rewardPoints: customer.rewardPoints,\n    });\n  }\n\n  async update(entity: Customer): Promise<void> {\n    await CustomerModel.update(\n      {\n        name: entity.name,\n        street: entity.address.street,\n        number: entity.address.number,\n        zip: entity.address.zip,\n        city: entity.address.city,\n        active: entity.isActive(),\n        rewardPoints: entity.rewardPoints,\n      },\n      {\n        where: {\n          id: entity.id,\n        },\n      }\n    );\n  }\n\n  async find(id: string): Promise<Customer> {\n    let customerModel;\n    try {\n      customerModel = await CustomerModel.findOne({\n        where: {\n          id,\n        },\n        rejectOnEmpty: true,\n      });\n    } catch (error) {\n      throw new Error(\"Customer not found...\");\n    }\n\n    const customer = new Customer(id, customerModel.name);\n    const address = new Address(\n      customerModel.street,\n      customerModel.number,\n      customerModel.zipcode,\n      customerModel.city\n    );\n    customer.changeAddress(address);\n    return customer;\n  }\n\n  async findAll(): Promise<Customer[]> {\n    const customerModels = await CustomerModel.findAll();\n\n    const customers = customerModels.map((customerModels) => {\n      let customer = new Customer(customerModels.id, customerModels.name);\n      customer.addRewardPoints(customerModels.rewardPoints);\n      const address = new Address(\n        customerModels.street,\n        customerModels.number,\n        customerModels.zipcode,\n        customerModels.city\n      );\n      customer.changeAddress(address);\n      if (customerModels.active) {\n        customer.activate();\n      }\n      return customer;\n    });\n\n    return customers;\n  }\n\n\n}\n"],"names":["Customer","Address","CustomerModel","CustomerRepository","create","customer","id","name","street","address","number","zipcode","zip","city","active","isActive","rewardPoints","update","entity","where","find","customerModel","error","findOne","rejectOnEmpty","Error","changeAddress","findAll","customerModels","customers","map","addRewardPoints","activate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,cAAc,8CAA8C;AACnE,OAAOC,aAAa,mDAAmD;AAEvE,OAAOC,mBAAmB,mBAAmB;AAE9B,IAAA,AAAMC,mCAAN;;aAAMA;gCAAAA;;kBAAAA;;YAEbC,KAAAA;mBAAN,SAAMA,OAAOC,QAAkB;;;;;gCAC7B;;oCAAMH,cAAcE,MAAM,CAAC;wCACzBE,IAAID,SAASC,EAAE;wCACfC,MAAMF,SAASE,IAAI;wCACnBC,QAAQH,SAASI,OAAO,CAACD,MAAM;wCAC/BE,QAAQL,SAASI,OAAO,CAACC,MAAM;wCAC/BC,SAASN,SAASI,OAAO,CAACG,GAAG;wCAC7BC,MAAMR,SAASI,OAAO,CAACI,IAAI;wCAC3BC,QAAQT,SAASU,QAAQ;wCACzBC,cAAcX,SAASW,YAAY;oCACrC;;;gCATA;;;;;;gBAUF;;;;YAEMC,KAAAA;mBAAN,SAAMA,OAAOC,MAAgB;;;;;gCAC3B;;oCAAMhB,cAAce,MAAM,CACxB;wCACEV,MAAMW,OAAOX,IAAI;wCACjBC,QAAQU,OAAOT,OAAO,CAACD,MAAM;wCAC7BE,QAAQQ,OAAOT,OAAO,CAACC,MAAM;wCAC7BE,KAAKM,OAAOT,OAAO,CAACG,GAAG;wCACvBC,MAAMK,OAAOT,OAAO,CAACI,IAAI;wCACzBC,QAAQI,OAAOH,QAAQ;wCACvBC,cAAcE,OAAOF,YAAY;oCACnC,GACA;wCACEG,OAAO;4CACLb,IAAIY,OAAOZ,EAAE;wCACf;oCACF;;;gCAdF;;;;;;gBAgBF;;;;YAEMc,KAAAA;mBAAN,SAAMA,KAAKd,EAAU;;wBACfe,eAQKC,OAIHjB,UACAI;;;;;;;;;;gCAXY;;oCAAMP,cAAcqB,OAAO,CAAC;wCAC1CJ,OAAO;4CACLb,IAAAA;wCACF;wCACAkB,eAAe;oCACjB;;;gCALAH,gBAAgB;;;;;;gCAMTC;gCACP,MAAM,IAAIG,MAAM;;gCAGZpB,WAAW,IAAIL,SAASM,IAAIe,cAAcd,IAAI;gCAC9CE,UAAU,IAAIR,QAClBoB,cAAcb,MAAM,EACpBa,cAAcX,MAAM,EACpBW,cAAcV,OAAO,EACrBU,cAAcR,IAAI;gCAEpBR,SAASqB,aAAa,CAACjB;gCACvB;;oCAAOJ;;;;gBACT;;;;YAEMsB,KAAAA;mBAAN,SAAMA;;wBACEC,gBAEAC;;;;gCAFiB;;oCAAM3B,cAAcyB,OAAO;;;gCAA5CC,iBAAiB;gCAEjBC,YAAYD,eAAeE,GAAG,CAAC,SAACF;oCACpC,IAAIvB,WAAW,IAAIL,SAAS4B,eAAetB,EAAE,EAAEsB,eAAerB,IAAI;oCAClEF,SAAS0B,eAAe,CAACH,eAAeZ,YAAY;oCACpD,IAAMP,UAAU,IAAIR,QAClB2B,eAAepB,MAAM,EACrBoB,eAAelB,MAAM,EACrBkB,eAAejB,OAAO,EACtBiB,eAAef,IAAI;oCAErBR,SAASqB,aAAa,CAACjB;oCACvB,IAAImB,eAAed,MAAM,EAAE;wCACzBT,SAAS2B,QAAQ;oCACnB;oCACA,OAAO3B;gCACT;gCAEA;;oCAAOwB;;;;gBACT;;;;WA9EmB1B;;AAArB,SAAqBA,gCAiFpB"}